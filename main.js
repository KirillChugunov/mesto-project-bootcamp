(()=>{"use strict";function e(e){e.classList.add("popup_opened"),document.addEventListener("keydown",n)}function t(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",n)}function n(e){"Escape"===e.key&&t(document.querySelector(".popup_opened"))}var r=document.querySelector(".popup__profile-edit"),o=document.querySelector(".profile__edit-button"),c=document.querySelector(".profile__title"),u=document.querySelector(".profile__avatar"),a=document.querySelector(".profile__subtitle"),i=document.querySelector("#input__title"),l=document.querySelector("#input__subtitle"),s=document.querySelector(".profile__add-button"),d=document.querySelector(".popup__add-element"),f=(d.querySelector(".popup__submit"),r.querySelector(".popup__form")),p=document.querySelector(".img-popup"),m=document.querySelector(".elements"),_=document.querySelector("#element__template").content,h=document.querySelector("#input__img-caption"),v=document.querySelector("#input__img-link"),y=(d.querySelector("popup__submit"),{formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__submit",inactiveButtonClass:"popup__submit_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"}),b=document.querySelector(".profile__avatar-button"),S=document.querySelector(".popup__avatar-edit"),g=document.querySelector("#input__avatar"),q=document.querySelector(".img-popup__figure"),E=document.querySelector(".img-popup__caption"),L=document.querySelectorAll(".popup"),C={baseUrl:"https://mesto.nomoreparties.co/v1/wbf-cohort-6",headers:{authorization:"d1f78d2c-b56d-404a-8b1d-91f3bcf47ed4","Content-Type":"application/json"}};function k(e){return e.ok?e.json():Promise.reject("".concat(e.status," - error"))}function x(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Сохранить",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Сохранение...";console.log("я отработал"),t.textContent=e?r:n}function A(t,n){var r=function(t,n){var r=_.querySelector(".elements__card").cloneNode(!0);r.querySelector(".elements__caption").textContent=t.name;var o=r.querySelector(".elements__photo");o.src=t.link,o.alt=r.textContent,r.id=t._id,o.addEventListener("click",(function(){e(p),q.src=o.src,q.alt="".concat(o.alt,"-img"),E.textContent=t.name})),function(e,t,n,r){t!=n?e.remove():e.addEventListener("click",(function(){(function(e){return fetch("".concat(C.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:C.headers}).then((function(e){return k(e)}))})(r).then((function(e){document.getElementById("".concat(r)).remove()})).catch((function(e){return console.log("".concat(e," - ошибка"))}))}))}(r.querySelector(".elements__delete-button"),n,t.owner._id,r.id);var c=r.querySelector(".elements__heart-button");return function(e,t,n){e.some((function(e){return e._id===t}))&&n.classList.add("elements__heart-button_active")}(t.likes,n,c),c.addEventListener("click",(function(){!function(e,t){t.classList.contains("elements__heart-button_active")?function(e,t){return fetch("".concat(C.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:C.headers}).then((function(e){return k(e)}))}(e).then((function(n){t.classList.remove("elements__heart-button_active"),U(n.likes.length,e)})).catch((function(e){return console.log("".concat(e," - ошибка"))})):function(e,t){return fetch("".concat(C.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:C.headers}).then((function(e){return k(e)}))}(e).then((function(n){t.classList.add("elements__heart-button_active"),U(n.likes.length,e)})).catch((function(e){return console.log("".concat(e," - ошибка"))}))}(r.id,c)})),r.querySelector(".elements__likes-count").textContent=t.likes.length,r}(t,n);m.prepend(r)}function U(e,t){document.getElementById("".concat(t)).querySelector(".elements__likes-count").textContent=e}function w(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?function(e,t){e.classList.remove(t.inactiveButtonClass),e.disabled=!1}(t,n):j(t,n)}function j(e,t){e.classList.add(t.inactiveButtonClass),e.disabled=!0}function O(e){e.addEventListener("reset",(function(){j(n,y)}));var t=Array.from(e.querySelectorAll(y.inputSelector)),n=e.querySelector(y.submitButtonSelector);w(t,n,y),t.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,n){t.validity.valid?function(e,t,n){var r=e.querySelector("#".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),r.classList.remove(n.errorClass),r.textContent=""}(e,t,n):function(e,t,n,r){var o=e.querySelector("#".concat(t.id,"-error"));t.classList.add(r.inputErrorClass),o.textContent=n,o.classList.add(r.errorClass)}(e,t,t.validationMessage,n)}(e,r,y),w(t,n,y)}))}))}function T(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}b.addEventListener("click",(function(){e(S)})),S.addEventListener("submit",(function(e){var n;e.preventDefault(),x(!0,e.submitter),(n=g.value,fetch("".concat(C.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:C.headers,body:JSON.stringify({avatar:n})}).then((function(e){return k(e)}))).then((function(n){u.src=n.avatar,e.target.reset(),t(S)})).catch((function(e){return console.log("".concat(e," - ошибка"))})).finally((function(t){x(!1,e.submitter)}))})),o.addEventListener("click",(function(){e(r),i.value=c.textContent,l.value=a.textContent})),f.addEventListener("submit",(function(e){var n,o;e.preventDefault(),x(!0,e.submitter),(n=i.value,o=l.value,fetch("".concat(C.baseUrl,"/users/me"),{method:"PATCH",headers:C.headers,body:JSON.stringify({name:n,about:o})}).then((function(e){return k(e)}))).then((function(n){c.textContent=n.name,a.textContent=n.about,e.target.reset(),t(r)})).catch((function(e){return console.log("".concat(e," - ошибка"))})).finally((function(t){x(!1,e.submitter)}))})),s.addEventListener("click",(function(){e(d)})),d.addEventListener("submit",(function(e){var n,r;e.preventDefault(),x(!0,e.submitter),(n=h.value,r=v.value,fetch("".concat(C.baseUrl,"/cards"),{method:"POST",headers:C.headers,body:JSON.stringify({name:n,link:r})}).then((function(e){return k(e)}))).then((function(n){A(n,n.owner._id),t(d),e.target.reset()})).catch((function(e){return console.log("".concat(e," - ошибка"))})).finally((function(t){x(!1,e.submitter)}))})),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(e){O(e)}))}(y),Promise.all([fetch("".concat(C.baseUrl,"/users/me"),{headers:C.headers}).then((function(e){return k(e)})),fetch("".concat(C.baseUrl,"/cards"),{headers:C.headers}).then((function(e){return k(e)}))]).then((function(e){var t,n,r=(n=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,c,u,a=[],i=!0,l=!1;try{if(c=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;i=!1}else for(;!(i=(r=c.call(n)).done)&&(a.push(r.value),a.length!==t);i=!0);}catch(e){l=!0,o=e}finally{try{if(!i&&null!=n.return&&(u=n.return(),Object(u)!==u))return}finally{if(l)throw o}}return a}}(t,n)||function(e,t){if(e){if("string"==typeof e)return T(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?T(e,t):void 0}}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),o=r[0],i=r[1];c.textContent=o.name,a.textContent=o.about,u.src=o.avatar,u.alt="".concat(o.name,"-avatar"),i.forEach((function(e){A(e,o._id)}))})).catch((function(e){return console.log("".concat(e," - ошибка"))})),function(e){e.forEach((function(e){e.addEventListener("mousedown",(function(n){n.target.classList.contains("popup_opened")&&t(e),n.target.classList.contains("popup__close")&&t(e)}))}))}(L)})();